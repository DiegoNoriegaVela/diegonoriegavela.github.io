/**
 * Formatea reporte T150 (Excepciones)
 * Regla: Cada registro empieza con "1IP" y tiene 134 caracteres máximo
 */
private static void formatT150Report(String transmissionId, File inputFile, 
        String outputFile, boolean debugMode) throws Exception {
    
    if (DEBUG || debugMode) {
        System.out.println("DEBUG: Aplicando formato T150 (registros de 134 chars iniciando con '1IP')");
    }

    try (BufferedReader reader = new BufferedReader(new FileReader(inputFile));
         PrintWriter writer = new PrintWriter(new FileWriter(outputFile))) {

        // Escribir header
        writer.println("[" + transmissionId + "]");

        // Leer todo el contenido
        StringBuilder content = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            content.append(line);
        }

        String fullText = content.toString();
        
        if (DEBUG || debugMode) {
            System.out.println("DEBUG: Longitud total del texto: " + fullText.length());
        }

        int linesWritten = 0;
        int position = 0;
        int totalLength = fullText.length();

        while (position < totalLength) {
            // Buscar el próximo "1IP" desde la posición actual
            int nextRecordStart = fullText.indexOf("1IP", position + 1);
            
            String recordLine;
            
            if (nextRecordStart == -1) {
                // No hay más registros "1IP", tomar el resto del texto
                recordLine = fullText.substring(position);
            } else {
                // Hay otro registro "1IP", cortar hasta ahí
                recordLine = fullText.substring(position, nextRecordStart);
            }
            
            // Validar que la línea tenga máximo 134 caracteres
            if (recordLine.length() > 134) {
                if (DEBUG || debugMode) {
                    System.out.println("DEBUG: ADVERTENCIA - Línea " + (linesWritten + 1) + 
                        " excede 134 caracteres (" + recordLine.length() + "), truncando");
                }
                recordLine = recordLine.substring(0, 134);
            }
            
            // Escribir la línea
            writer.println(recordLine);
            linesWritten++;
            
            if (DEBUG || debugMode) {
                System.out.println("DEBUG: Línea " + linesWritten + ": " + recordLine.length() + " chars - " + 
                    (recordLine.startsWith("1IP") ? "Inicia con 1IP" : "NO inicia con 1IP"));
            }
            
            // Avanzar posición
            if (nextRecordStart == -1) {
                break; // No hay más registros
            }
            position = nextRecordStart;
        }

        if (DEBUG || debugMode) {
            System.out.println("DEBUG: Total de líneas escritas: " + linesWritten);
        }
    }
}
