import java.io.*;
import java.nio.file.*;

public class IsoLogConverter {
    
    public static void main(String[] args) {
        if (args.length < 2) {
            System.out.println("Uso: java IsoLogConverter --input <ruta_archivo>");
            return;
        }
        
        String inputPath = args[1];
        convertFile(inputPath);
    }
    
    public static void convertFile(String inputPath) {
        try {
            // Leer todas las líneas del archivo
            Path path = Paths.get(inputPath);
            String content = new String(Files.readAllBytes(path));
            
            // Separar por líneas
            String[] lines = content.split("\n");
            StringBuilder output = new StringBuilder();
            
            for (String line : lines) {
                if (line.length() >= 32) {
                    // Extraer los primeros 32 caracteres (bitmap en hex)
                    String bitmapHex = line.substring(0, 32);
                    String resto = line.substring(32);
                    
                    // Convertir hex a bytes
                    byte[] bitmapBytes = hexToBytes(bitmapHex);
                    
                    // Convertir bytes de vuelta a string para escribir
                    String bitmapBinary = bytesToString(bitmapBytes);
                    
                    output.append(bitmapBinary).append(resto).append("\n");
                } else {
                    output.append(line).append("\n");
                }
            }
            
            // Crear nombre del archivo de salida
            String outputPath = inputPath.replaceAll("(\\.[^.]+)?$", ".binary");
            
            // Escribir el archivo de salida
            Files.write(Paths.get(outputPath), output.toString().getBytes());
            
            System.out.println("Archivo convertido exitosamente: " + outputPath);
            
        } catch (IOException e) {
            System.err.println("Error procesando archivo: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // Convierte string hexadecimal a bytes
    private static byte[] hexToBytes(String hex) {
        int len = hex.length();
        byte[] bytes = new byte[len / 2];
        
        for (int i = 0; i < len; i += 2) {
            bytes[i / 2] = (byte) ((Character.digit(hex.charAt(i), 16) << 4)
                                 + Character.digit(hex.charAt(i+1), 16));
        }
        
        return bytes;
    }
    
    // Convierte bytes a string (para escribir en archivo)
    private static String bytesToString(byte[] bytes) {
        return new String(bytes);
    }
}
